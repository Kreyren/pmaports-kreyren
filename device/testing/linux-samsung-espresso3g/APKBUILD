pkgname=linux-samsung-espresso3g
pkgver=5.12_rc1
pkgrel=2
pkgdesc="Samsung Galaxy Tab 2 (7.0 inch) mainline kernel"
arch="armv7"
_carch="arm"
_flavor="samsung-espresso3g"
url="https://kernel.org"
license="GPL2"
options="!strip !check !tracedeps pmb:cross-native"
makedepends="openssl-dev yaml-dev mpc1-dev mpfr-dev xz findutils bison flex perl sed installkernel bash gmp-dev bc linux-headers elfutils-dev"
_commit="cf34a37251a0133a8d4648b8ac8aba38b41fddf7"
_config="config-$_flavor.$arch"
source="
	$pkgname-$_commit.tar.gz::https://github.com/MightyM17/linux_openpvrsgx/archive/$_commit.tar.gz
	$_config
"
builddir="$srcdir/linux_openpvrsgx-$_commit"

prepare() {
	default_prepare
	cp "$srcdir/config-$_flavor.$arch" .config
}

build() {
	unset LDFLAGS
	make ARCH="$_carch" CC="${CC:-gcc}" \
		KBUILD_BUILD_VERSION="$((pkgrel + 1 ))-postmarketOS"
}

package() {
	install -Dm644 "$builddir/arch/$_carch/boot/"*zImage \
		"$pkgdir/boot/vmlinuz"

	install -D "$builddir"/include/config/kernel.release \
		"$pkgdir"/usr/share/kernel/$_flavor/kernel.release

	make -j1 modules_install dtbs_install \
		ARCH="$_carch" \
		INSTALL_MOD_PATH="$pkgdir" \
		INSTALL_DTBS_PATH="$pkgdir/usr/share/dtb"
}

sha512sums="
3f40d79314e36555b350ec395b476a144cf8a8a11cb2b1bd599ee6af2d8627cd12fe2f7fa9cfb4749fe82056b989903dfac6d254448cc90e2b1aeb1ede3947e5  linux-samsung-espresso3g-cf34a37251a0133a8d4648b8ac8aba38b41fddf7.tar.gz
e786e6f6d4bb406ab1dae31d1dd7a34d9bdf332c2af3eb2a60643e6d35173362d851b093aa66bb1ce354bcc366e63d4aba65ee28cec97480fce994849518e3f3  config-samsung-espresso3g.armv7
"
