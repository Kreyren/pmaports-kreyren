pkgname=linux-samsung-espresso3g
pkgver=5.15_rc1
pkgrel=0
pkgdesc="Samsung Galaxy Tab 2 (7.0 inch) mainline kernel"
arch="armv7"
_carch="arm"
_flavor="samsung-espresso3g"
url="https://kernel.org"
license="GPL2"
options="!strip !check !tracedeps pmb:cross-native"
makedepends="openssl-dev yaml-dev mpc1-dev mpfr-dev xz findutils bison flex perl sed installkernel bash gmp-dev bc linux-headers elfutils-dev"
_commit="7f948007463451675a274ec0abaefdd9253ae56b"
_config="config-$_flavor.$arch"
source="
	$pkgname-$_commit.tar.gz::https://github.com/openpvrsgx-devgroup/linux_openpvrsgx/archive/$_commit.tar.gz
	00-add-espresso-dts.patch
	$_config
"
builddir="$srcdir/linux_openpvrsgx-$_commit"

prepare() {
	default_prepare
	cp "$srcdir/config-$_flavor.$arch" .config
}

build() {
	unset LDFLAGS
	make ARCH="$_carch" CC="${CC:-gcc}" \
		KBUILD_BUILD_VERSION="$((pkgrel + 1 ))-postmarketOS"
}

package() {
	install -Dm644 "$builddir/arch/$_carch/boot/"*zImage \
		"$pkgdir/boot/vmlinuz"

	install -D "$builddir"/include/config/kernel.release \
		"$pkgdir"/usr/share/kernel/$_flavor/kernel.release

	make -j1 modules_install dtbs_install \
		ARCH="$_carch" \
		INSTALL_MOD_PATH="$pkgdir" \
		INSTALL_DTBS_PATH="$pkgdir/usr/share/dtb"
}

sha512sums="
6af57b5b1c91b611eae2a495a014701a53db3f2f99e6f043d7640d788250555e2f5dcbf7ec3deb4ce3124dea809132dd81939be5faa73be2dda48483f341e44b  linux-samsung-espresso3g-7f948007463451675a274ec0abaefdd9253ae56b.tar.gz
696569663acf0148b546fcd1441697eee5166a36ac9f6e8df8b17881a4ade7d85afd39db4f1b2618b210bf3ca31144eb6e0d12fa90e1db9df9a985ecbd52d144  00-add-espresso-dts.patch
45d5ef35ccf019fed80860436b544d4b632ef0dacd95540aeedbc2e25d705ea717050e7c41a77f2e6cdca6e839f4f32749054bff6011dc103f1f95152da732cc  config-samsung-espresso3g.armv7
"
