pkgname=firmware-fairphone-fp2
pkgver=18.04.1
pkgrel=0
pkgdesc="Firmware for Fairphone 2"
subpackages="$pkgname-adsp $pkgname-modem $pkgname-venus $pkgname-wcnss"
url="https://github.com/FairBlobs/FP2-firmware"
arch="armv7"
license="proprietary"
options="!check !strip !archcheck"

# Sources
_fw_commit="06b1dd34b9520ae829201fbd0ca090e4a9ca30fb"
_dev_commit="6785087409c73b046d11a5c88225d4177e172a1d"
_wififiles="WCNSS_cfg.dat WCNSS_qcom_cfg.ini WCNSS_qcom_wlan_nv.bin"
source="$pkgname-$_fw_commit.tar.gz::https://github.com/FairBlobs/FP2-firmware/archive/$_fw_commit.tar.gz"
for _i in $_wififiles; do
	source="$source $pkgname-$_dev_commit-$_i::https://raw.githubusercontent.com/LineageOS/android_device_fairphone_FP2/$_dev_commit/wifi/$_i";
done
builddir="$srcdir/FP2-firmware-$_fw_commit"

package() {
	# parent package is empty
	mkdir -p "$pkgdir"
}

adsp() {
	pkgdesc="Fairphone 2 adsp firmware"

	cd "$builddir"
	for _i in adsp.*; do
		install -Dm644 $_i "$subpkgdir"/lib/firmware/postmarketos/$_i
	done
}

modem() {
	pkgdesc="Fairphone 2 modem firmware"

	cd "$builddir"
	for _i in modem.* mba.*; do
		install -Dm644 $_i "$subpkgdir"/lib/firmware/postmarketos/$_i
	done
}

venus() {
	pkgdesc="Fairphone 2 venus firmware"

	cd "$builddir"
	for _i in venus.*; do
		install -Dm644 $_i "$subpkgdir"/lib/firmware/postmarketos/$_i
	done
}

wcnss() {
	pkgdesc="Fairphone 2 firmware for the Qualcomm Wireless Connectivity Subsystem (WCNSS)"

	cd "$builddir"
	for _i in wcnss.*; do
		install -Dm644 $_i "$subpkgdir"/lib/firmware/postmarketos/$_i
	done
	for _i in $_wififiles; do
		install -Dm644 "$srcdir/$pkgname-$_dev_commit-$_i" \
			"$subpkgdir/lib/firmware/postmarketos/wlan/prima/$_i"
	done
}

sha512sums="da3f7a793d3f36bca7a647cbbec69fc89c3ca7a948a3445368105687d68c8a8c811352641f2c90e81f19fa967694fa8cc1afb89fc69a7f8302344b846da7d38b  firmware-fairphone-fp2-06b1dd34b9520ae829201fbd0ca090e4a9ca30fb.tar.gz
619df454e0dc65ab62894b7f328c015729e8261919032ee9096bb4f983ddd6f7b98dd14f593b4c6b75cf86c09f090a9cde7674f4c8197cda927a2ac47111cd2e  firmware-fairphone-fp2-6785087409c73b046d11a5c88225d4177e172a1d-WCNSS_cfg.dat
50625167fd5d3de8b834327a518714299972de3bd3077cb10d4317fb8135b52eb2f0d89f696f48e0530ac8d7a20e76ad01e30ebabec405ef241dc8b1cd52d94c  firmware-fairphone-fp2-6785087409c73b046d11a5c88225d4177e172a1d-WCNSS_qcom_cfg.ini
d29aaefa6e42bd4a2146b79ee0f0fb6698dae34978bf9bebee9cfa96795c0329be1f7e896cf707f121dab35872d4ce9540b3c79c43bdfd98c75c16d2d875ab3c  firmware-fairphone-fp2-6785087409c73b046d11a5c88225d4177e172a1d-WCNSS_qcom_wlan_nv.bin"
