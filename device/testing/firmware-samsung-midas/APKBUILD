pkgname=firmware-samsung-midas
pkgver=3
pkgrel=0
pkgdesc="Samsung Galaxy Midas board firmware (m0, m3, t0lte, ...)"
_commit="fdd8c44568a148c22fbf008de822ff4e27992da1"
url="https://github.com/TheMuppets/proprietary_vendor_samsung"
_armbian_commit="5ff122ef309a1ddabb4bf7f37c8347c43b314a61"
_armbian_url="https://github.com/armbian/firmware"
arch="armv7"
license="proprietary"
replaces="firmware-samsung-m0"
subpackages="
	$pkgname-bluetooth
	$pkgname-wifi
	"
source="
	$url/raw/$_commit/smdk4412-common/proprietary/bin/bcm4334.hcd
	$_armbian_url/raw/$_armbian_commit/brcm/brcmfmac4334-sdio.bin
	$_armbian_url/raw/$_armbian_commit/brcm/brcmfmac4334-sdio.rockchip%2Crk3318-box.txt
"
options="!check !strip !archcheck !spdx !tracedeps pmb:cross-native"

package() {
	mkdir -p "$pkgdir"/lib/firmware/postmarketos
}

bluetooth() {
	depends="$pkgname"
	replaces="firmware-samsung-m0-mainline"
	mkdir -p "$subpkgdir"/lib/firmware/brcm
	install -m644 "$srcdir"/bcm4334.hcd \
		"$subpkgdir"/lib/firmware/brcm/BCM4334B0.hcd
}

wifi() {
	depends="$pkgname"
	replaces="firmware-samsung-m0-mainline"
	mkdir -p "$subpkgdir"/lib/firmware/brcm \
		"$subpkgdir"/lib/firmware/postmarketos

	install -m644 "$srcdir"/brcmfmac4334-sdio.bin \
		"$subpkgdir"/lib/firmware/postmarketos/brcmfmac4334-sdio.bin
	ln -s /lib/firmware/postmarketos/brcmfmac4334-sdio.bin \
		"$subpkgdir"/lib/firmware/brcm/brcmfmac4334-sdio.samsung,i9300.bin
	ln -s /lib/firmware/postmarketos/brcmfmac4334-sdio.bin \
		"$subpkgdir"/lib/firmware/brcm/brcmfmac4334-sdio.samsung,i9305.bin

	install -m644 "$srcdir"/brcmfmac4334-sdio.rockchip%2Crk3318-box.txt \
		"$subpkgdir"/lib/firmware/postmarketos/brcmfmac4334-sdio.txt
	ln -s /lib/firmware/postmarketos/brcmfmac4334-sdio.txt \
		"$subpkgdir"/lib/firmware/brcm/brcmfmac4334-sdio.samsung,i9300.txt
	ln -s /lib/firmware/postmarketos/brcmfmac4334-sdio.txt \
		"$subpkgdir"/lib/firmware/brcm/brcmfmac4334-sdio.samsung,i9305.txt
}

sha512sums="
cbed1dc60829161c7ac9649dcae67fc45204c1a25e8de320ad3bc4e9d5cae573fb8a4745f91355fa96d2d3d4124a9e707341fc5bd1b22705cb2efb16831e029f  bcm4334.hcd
528b8087ce2d985c397b1072070bd743114b7176340cd7612ca5d293e2059b1c483522c3adc4f58c4daf738848e95d3541195608f47acc5236032b6a2bfee441  brcmfmac4334-sdio.bin
d5c83e1dcd67630e186ab484d150ca5c0af12810de62a46ec6e525b50dabf64a75f1231ef8d7c1d102fb76389210fdb952975460179ca767acd0ffdd869907d7  brcmfmac4334-sdio.rockchip%2Crk3318-box.txt
"
