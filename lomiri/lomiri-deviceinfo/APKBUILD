# Maintainer: Luca Weiss <luca@z3ntu.xyz>
pkgname=lomiri-deviceinfo
pkgver=0.1.0_git20230207
_commit="fe939f071aafa47f631caec55a4e8420b3eb4a12"
pkgrel=0
pkgdesc="Library to detect and configure devices"
arch="all"
url="https://gitlab.com/ubports/development/core/deviceinfo"
license="GPL-3.0-only"
makedepends="cmake cmake-extras gtest-dev yaml-cpp-dev"
source="https://gitlab.com/ubports/development/core/deviceinfo/-/archive/$_commit/deviceinfo-$_commit.tar.gz"
subpackages="$pkgname-dev"
builddir="$srcdir/deviceinfo-$_commit"

build() {
	cmake -B build \
		-DCMAKE_BUILD_TYPE=None \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCONFIG_PATH=/etc/lomiri-deviceinfo
	cmake --build build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	DESTDIR="$pkgdir" cmake --build build --target install
}

sha512sums="
35971ec2b0e19fcf6dd41cc36c8da271572aa8d5b80659e1ef6978ae035d5666cd2f650beb7dd5a5e707f49ecd3ef956b4d37c630e6ffc95dc349fbe7ac7cb85  deviceinfo-fe939f071aafa47f631caec55a4e8420b3eb4a12.tar.gz
"
