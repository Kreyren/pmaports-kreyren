# Maintainer: Brandon Boese <brandonboese@protonmail.com>
pkgname=lomiri-clock-app
pkgver=4.0.3_git2023101
_commit="0bb4ff5cf7553a00564b7ec6786c594694871d18"
pkgrel=0
pkgdesc="Clock App for Lomiri Operating Environment"
url="https://gitlab.com/ubports/development/apps/lomiri-clock-app"
arch="all !armhf !x86"
license="GPL-3.0-only"
depends="lomiri-ui-toolkit lomiri-ui-extras gsettings-qt geonames"
makedepends="cmake cmake-extras qt5-qtbase-dev click-dev gnome-desktop-dev trust-store-dev qt5-qtdeclarative-dev qt5-qtdeclarative geonames-dev"
checkdepends="xvfb-run py3-xdg py3-dbusmock"
subpackages="$pkgname-lang"
source="$pkgname-$_commit.tar.gz::https://gitlab.com/ubports/development/apps/lomiri-clock-app/-/archive/$_commit/lomiri-clock-app-$_commit.tar.gz"
options="!check" # tests do not run
builddir="$srcdir/$pkgname-$_commit"

build() {
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_INSTALL_SYSCONFDIR=/etc \
		-DCMAKE_INSTALL_LOCALSTATEDIR=/var \
		-DCLICK_MODE=off
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="
622fd2b3883e3b6c12bf78eabdd6c7e32d73851854cf94d65e9941cb9c6a22978bbbf67507af766902859253009f9de450b1221cc0cd003e02cfbc092ea5f35f  lomiri-clock-app-0bb4ff5cf7553a00564b7ec6786c594694871d18.tar.gz
"
