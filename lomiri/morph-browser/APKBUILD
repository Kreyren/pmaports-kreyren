# Maintainer: Brandon Boese <brandonboese@protonmail.com>
pkgname=morph-browser
pkgver=2.0.1_git20231012
_commit="189adf27d61eea3c54f80d5df6b0f6fa15a87d0a"
pkgrel=0
pkgdesc="Lightweight web browser tailored for Ubuntu Touch"
url="https://gitlab.com/ubports/development/core/morph-browser"
arch="all !armhf"
license="GPL-3.0-only"
depends="
	lomiri-ui-toolkit
	lomiri-ui-extras
	font-liberation
	qt5-qtbase
	qt5-qtbase-sqlite
	qt5-qtwebengine
	qt5-qtdeclarative
	qt5-qtquickcontrols2
	"
makedepends="
	cmake
	cmake-extras
	qt5-qtbase-dev
	click-dev
	gnome-desktop-dev
	lomiri-trust-store-dev
	qt5-qtdeclarative-dev
	qt5-qtdeclarative
	qt5-qtwebengine-dev
	qt5-qtwebengine
	libapparmor-dev
	xvfb-run
	"
checkdepends="xvfb-run py3-xdg py3-dbusmock"
subpackages="$pkgname-lang"
source="$pkgname-$_commit.tar.gz::https://gitlab.com/ubports/development/core/morph-browser/-/archive/$_commit/morph-browser-$_commit.tar.gz"
builddir="$srcdir/$pkgname-$_commit"
options="!check" # 4 tests fail and test 27 hangs

build() {
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_INSTALL_SYSCONFDIR=/etc \
		-DCMAKE_INSTALL_LOCALSTATEDIR=/var \
		-DCLICK_MODE=off
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="
7a2c69daa6c6d6ecf6bffce13de48dc8f5c33c9bee703c67dce2c061a24ae4dc84fb8aed162d521000a317178d00eb417df62500e3e43132fb685a6c176792f8  morph-browser-189adf27d61eea3c54f80d5df6b0f6fa15a87d0a.tar.gz
"
