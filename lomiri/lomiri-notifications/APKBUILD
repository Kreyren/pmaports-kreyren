# Maintainer: Brandon Boese <brandonboese@protonmail.com>
pkgname=lomiri-notifications
pkgver=1.3.0
pkgrel=0
pkgdesc="An implementation of the Free Desktop Notification server for Lomiri"
url="https://gitlab.com/ubports/development/core/lomiri-notifications"
arch="all !armhf"
license="GPL-3.0-only"
depends="lomiri qt5-qtbase qt5-qtdeclarative"
makedepends="cmake qt5-qtbase-dev qt5-qtdeclarative-dev qt5-qtdeclarative lomiri-api-dev libqtdbustest"
checkdepends="qt5-qtbase-dev qt5-qtdeclarative-dev qt5-qtquickcontrols2-dev"
source="$pkgname-$pkgver.tar.gz::https://gitlab.com/ubports/development/core/lomiri-notifications/-/archive/$pkgver/lomiri-notifications-$pkgver.tar.gz"
builddir="$srcdir/$pkgname-$pkgver"
options="!check" # tests fail

build() {
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DCMAKE_INSTALL_SYSCONFDIR=/etc \
		-DCMAKE_INSTALL_LOCALSTATEDIR=/var
	make -C build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	make -C build DESTDIR="$pkgdir" install
}

sha512sums="
5e60238ee5c926324cd9749e425e3da62ff27634e31c4db22e328dd4e9508e15ff1cba28aade48982f9d9d884fcb6720f0bb32e8c89e8ede35db1dcd8e433f14  lomiri-notifications-1.3.0.tar.gz
"
