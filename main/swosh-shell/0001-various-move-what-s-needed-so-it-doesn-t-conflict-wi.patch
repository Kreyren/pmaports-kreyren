From c20b96a2067dfa7f29505f920413e916785f5fe9 Mon Sep 17 00:00:00 2001
From: Antoine Fontaine <antoine.fontaine@epfl.ch>
Date: Sun, 21 Jun 2020 08:35:59 +0200
Subject: [PATCH 1/5] various: move what's needed so it doesn't conflict with
 phosh and change compositor to sway

---
 data/meson.build                              | 15 ++++----
 data/phoc.ini                                 | 22 ------------
 data/phosh.in                                 | 34 -------------------
 ...ktop.in.in => sm.puri.Swosh.desktop.in.in} |  2 +-
 ....in.in => sm.puri.SwoshOSK0.desktop.in.in} |  2 +-
 ....gschema.xml => sm.puri.swosh.gschema.xml} |  0
 data/swosh.in                                 |  9 +++++
 ...ktop.in.in => swosh.session.desktop.in.in} |  4 +--
 data/wayland-sessions/phosh.desktop           |  6 ----
 data/wayland-sessions/swosh.desktop           |  6 ++++
 meson.build                                   |  4 +--
 src/meson.build                               |  2 +-
 tools/meson.build                             |  2 +-
 13 files changed, 30 insertions(+), 78 deletions(-)
 delete mode 100644 data/phoc.ini
 delete mode 100755 data/phosh.in
 rename data/{sm.puri.Phosh.desktop.in.in => sm.puri.Swosh.desktop.in.in} (92%)
 rename data/{sm.puri.OSK0.desktop.in.in => sm.puri.SwoshOSK0.desktop.in.in} (90%)
 rename data/{sm.puri.phosh.gschema.xml => sm.puri.swosh.gschema.xml} (100%)
 create mode 100755 data/swosh.in
 rename data/{phosh.session.desktop.in.in => swosh.session.desktop.in.in} (82%)
 delete mode 100644 data/wayland-sessions/phosh.desktop
 create mode 100644 data/wayland-sessions/swosh.desktop

diff --git a/data/meson.build b/data/meson.build
index 52dcb2a..6f12665 100644
--- a/data/meson.build
+++ b/data/meson.build
@@ -3,8 +3,8 @@ desktopconf.set('bindir', bindir)
 desktopconf.set('libexecdir', libexecdir)
 
 desktop_files = [
-  'sm.puri.Phosh.desktop',
-  'sm.puri.OSK0.desktop',
+  'sm.puri.Swosh.desktop',
+  'sm.puri.SwoshOSK0.desktop',
 ]
 foreach desktop_file : desktop_files
   i18n.merge_file('desktop',
@@ -22,7 +22,7 @@ foreach desktop_file : desktop_files
 endforeach
 
 sessions = [
-  'phosh.session',
+  'swosh.session',
 ]
 foreach session: sessions
   desktop = session + '.desktop'
@@ -47,14 +47,14 @@ runconf.set('libexecdir', libexecdir)
 runconf.set('pkgdatadir', pkgdatadir)
 runconf.set('wlrootsdir', join_paths(libexecdir, 'wlroots'))
 configure_file(
-  input: 'phosh.in',
-  output: 'phosh',
+  input: 'swosh.in',
+  output: 'swosh',
   install_dir: bindir,
   configuration: runconf,
   install: true
 )
 
-schemas = ['sm.puri.phosh.gschema.xml']
+schemas = ['sm.puri.swosh.gschema.xml']
 compiled = gnome.compile_schemas(
   build_by_default: true
 )
@@ -64,7 +64,6 @@ install_data(
   install_dir: 'share/glib-2.0/schemas'
 )
 
-install_data('phoc.ini', install_dir : pkgdatadir)
-install_data('wayland-sessions/phosh.desktop',
+install_data('wayland-sessions/swosh.desktop',
 	     install_dir : 'share/wayland-sessions')
 
diff --git a/data/phoc.ini b/data/phoc.ini
deleted file mode 100644
index 9713674..0000000
--- a/data/phoc.ini
+++ /dev/null
@@ -1,22 +0,0 @@
-#[core]
-#xwayland=false
-
-[output:DSI-1]
-scale = 2
-
-[output:Virtual-1]
-# For the x86 VM using QXL to get a phone like geometry
-modeline = 87.25  720 776 848 976  1440 1443 1453 1493 -hsync +vsync
-mode = 720x1440
-scale = 2
-
-[output:X11-1]
-mode = 360x720
-#rotate = 90
-scale = 1
-
-[output:WL-1]
-mode = 360x720
-#rotate = 90
-scale = 1
-
diff --git a/data/phosh.in b/data/phosh.in
deleted file mode 100755
index 78791a9..0000000
--- a/data/phosh.in
+++ /dev/null
@@ -1,34 +0,0 @@
-#!/bin/sh
-
-COMPOSITOR="/usr/bin/phoc"
-PHOC_INI="@pkgdatadir@/phoc.ini"
-
-gnome_session_args()
-{
-    ARGS="--disable-acceleration-check --session=phosh"
-
-    # Use builtin session handling until we can rely
-    # on a newer gnome-session everywhere
-    if gnome-session --help | grep -qs -e--builtin; then
-        ARGS="--builtin ${ARGS}"
-    fi
-
-    echo "${ARGS}"
-}
-
-if [ -x @bindir@/phoc ]; then
-  COMPOSITOR=@bindir@/phoc
-fi
-
-if [ -f /etc/phosh/phoc.ini ]; then
-  PHOC_INI=/etc/phosh/phoc.ini
-elif  [ -f /etc/phosh/rootston.ini ]; then
-  # honor old configs
-  PHOC_INI=/etc/phosh/rootston.ini
-fi
-
-# Run gnome-session through a login shell so it picks
-# variables from /etc/profile.d (XDG_*)
-[ -n "$WLR_BACKENDS" ] || WLR_BACKENDS=drm,libinput
-export WLR_BACKENDS
-exec "${COMPOSITOR}" -C "${PHOC_INI}" -E "bash -lc 'gnome-session $(gnome_session_args)'"
diff --git a/data/sm.puri.Phosh.desktop.in.in b/data/sm.puri.Swosh.desktop.in.in
similarity index 92%
rename from data/sm.puri.Phosh.desktop.in.in
rename to data/sm.puri.Swosh.desktop.in.in
index 878730b..aed91f5 100644
--- a/data/sm.puri.Phosh.desktop.in.in
+++ b/data/sm.puri.Swosh.desktop.in.in
@@ -2,7 +2,7 @@
 Type=Application
 Name=Phone Shell
 Comment=Window management and application launching for mobile
-Exec=@libexecdir@/phosh
+Exec=@libexecdir@/swosh
 Categories=GNOME;GTK;Core;
 OnlyShowIn=GNOME;
 NoDisplay=true
diff --git a/data/sm.puri.OSK0.desktop.in.in b/data/sm.puri.SwoshOSK0.desktop.in.in
similarity index 90%
rename from data/sm.puri.OSK0.desktop.in.in
rename to data/sm.puri.SwoshOSK0.desktop.in.in
index a0cafa1..ca06a55 100644
--- a/data/sm.puri.OSK0.desktop.in.in
+++ b/data/sm.puri.SwoshOSK0.desktop.in.in
@@ -2,7 +2,7 @@
 Type=Application
 Name=On-screen keyboard stub
 Comment=On-screen keyboard stub
-Exec=@bindir@/phosh-osk-stub
+Exec=@bindir@/swosh-osk-stub
 Categories=GNOME;Core;
 OnlyShowIn=GNOME;
 NoDisplay=true
diff --git a/data/sm.puri.phosh.gschema.xml b/data/sm.puri.swosh.gschema.xml
similarity index 100%
rename from data/sm.puri.phosh.gschema.xml
rename to data/sm.puri.swosh.gschema.xml
diff --git a/data/swosh.in b/data/swosh.in
new file mode 100755
index 0000000..0b0c7f4
--- /dev/null
+++ b/data/swosh.in
@@ -0,0 +1,9 @@
+#!/bin/sh
+
+COMPOSITOR="/usr/bin/sway"
+
+# Run gnome-session through a login shell so it picks
+# variables from /etc/profile.d (XDG_*)
+[ -n "$WLR_BACKENDS" ] || WLR_BACKENDS=drm,libinput
+export WLR_BACKENDS
+exec "${COMPOSITOR}"
diff --git a/data/phosh.session.desktop.in.in b/data/swosh.session.desktop.in.in
similarity index 82%
rename from data/phosh.session.desktop.in.in
rename to data/swosh.session.desktop.in.in
index a534783..8da8f08 100644
--- a/data/phosh.session.desktop.in.in
+++ b/data/swosh.session.desktop.in.in
@@ -1,4 +1,4 @@
 [GNOME Session]
 # Translators: this is the session name, no need to translate it
-Name=Phosh
-RequiredComponents=sm.puri.Phosh;org.gnome.SettingsDaemon.A11ySettings;org.gnome.SettingsDaemon.Color;org.gnome.SettingsDaemon.Datetime;org.gnome.SettingsDaemon.Housekeeping;org.gnome.SettingsDaemon.Keyboard;org.gnome.SettingsDaemon.Power;org.gnome.SettingsDaemon.PrintNotifications;org.gnome.SettingsDaemon.Rfkill;org.gnome.SettingsDaemon.ScreensaverProxy;org.gnome.SettingsDaemon.Sharing;org.gnome.SettingsDaemon.Smartcard;org.gnome.SettingsDaemon.Sound;sm.puri.OSK0;
+Name=Swosh
+RequiredComponents=sm.puri.Swosh;org.gnome.SettingsDaemon.A11ySettings;org.gnome.SettingsDaemon.Color;org.gnome.SettingsDaemon.Datetime;org.gnome.SettingsDaemon.Housekeeping;org.gnome.SettingsDaemon.Keyboard;org.gnome.SettingsDaemon.Power;org.gnome.SettingsDaemon.PrintNotifications;org.gnome.SettingsDaemon.Rfkill;org.gnome.SettingsDaemon.ScreensaverProxy;org.gnome.SettingsDaemon.Sharing;org.gnome.SettingsDaemon.Smartcard;org.gnome.SettingsDaemon.Sound;sm.puri.SwoshOSK0;
diff --git a/data/wayland-sessions/phosh.desktop b/data/wayland-sessions/phosh.desktop
deleted file mode 100644
index 7b3cf3d..0000000
--- a/data/wayland-sessions/phosh.desktop
+++ /dev/null
@@ -1,6 +0,0 @@
-[Desktop Entry]
-Name=Phosh
-Comment=Phone Shell
-Exec=phosh
-Type=Application
-
diff --git a/data/wayland-sessions/swosh.desktop b/data/wayland-sessions/swosh.desktop
new file mode 100644
index 0000000..dfe2614
--- /dev/null
+++ b/data/wayland-sessions/swosh.desktop
@@ -0,0 +1,6 @@
+[Desktop Entry]
+Name=Swosh
+Comment=Swosh Shell
+Exec=swosh
+Type=Application
+
diff --git a/meson.build b/meson.build
index d3f9ff5..80fc4ed 100644
--- a/meson.build
+++ b/meson.build
@@ -1,4 +1,4 @@
-project('phosh', 'c',
+project('swosh', 'c',
           version: '0.4.3',
           license: 'GPLv3+',
     meson_version: '>= 0.49.0',
@@ -149,7 +149,7 @@ subdir('docs')
 summary = [
   '',
   '-----------',
-  'Phosh @0@'.format(meson.project_version()),
+  'Swosh @0@'.format(meson.project_version()),
   '',
   '        Tests: @0@'.format(get_option('tests')),
   '   Phoc Tests: @0@'.format(run_phoc_tests),
diff --git a/src/meson.build b/src/meson.build
index 6266914..1308e42 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -200,7 +200,7 @@ phosh_doc_dep = declare_dependency(sources: libphosh_generated_sources,
   dependencies: phosh_deps)
 endif
 
-phosh = executable('phosh', ['main.c', libphosh_sources],
+phosh = executable('swosh', ['main.c', libphosh_sources],
   dependencies: phosh_tool_dep,
   install: true,
   install_dir: libexecdir)
diff --git a/tools/meson.build b/tools/meson.build
index 5d6e2f6..cf625be 100644
--- a/tools/meson.build
+++ b/tools/meson.build
@@ -22,7 +22,7 @@ executable('app-grid-standalone', ['app-grid-standalone.c'] + stubs,
 executable('image-notify', ['image-notify.c'] + stubs,
            dependencies: phosh_tool_dep)
 
-executable('phosh-osk-stub', ['phosh-osk-stub.c'],
+executable('swosh-osk-stub', ['phosh-osk-stub.c'],
            install: true,
            dependencies: osk_stub_deps)
 
-- 
2.28.0

