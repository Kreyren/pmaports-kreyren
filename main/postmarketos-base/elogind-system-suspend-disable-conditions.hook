#!/bin/sh

case $1/$2 in
  pre/*)
	# Do not suspend if...

	# there is an ssh connection to the device
	ssh_active=$(pgrep -af 'sshd:.*pts')
	if [ -n "$ssh_active" ]; then
		echo "CANCELLED: SSH session is active, NOT suspending."
		exit
	fi

	# apk is running
	apk_active=$(lslocks -rn|grep /lib/apk/db/lock)
	if [ -n "$apk_active" ]; then
		echo "CANCELLED: apk is running, NOT suspending."
		exit
	fi

	;;
esac

