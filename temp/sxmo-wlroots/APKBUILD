# Backported from alpine edge to support sxmo-sway
# Sxmo-sway will always use this package over wlroots because of this package in alpine 3.15 stable:
# https://pkgs.alpinelinux.org/package/v3.15/community/x86_64/sxmo-wlroots
# MAKE SURE THIS PACKAGE IS THE SAME AS wlroots PACKAGE IN PMAPORTS
# EVERYTHING SHOULD BE THE SAME EXCEPT FOR THE pkgname VARIABLE AND builddir
# REMOVE THIS PACKAGE FOR THE NEXT RELEASE OF PMOS
pkgname=sxmo-wlroots
pkgver=0.15.0
pkgrel=0
pkgdesc="Modular Wayland compositor library"
url="https://gitlab.freedesktop.org/wlroots/wlroots"
license="MIT"
arch="all"
makedepends="
	eudev-dev
	libcap-dev
	libinput-dev
	libseat-dev
	libxcb-dev
	libxkbcommon-dev
	mesa-dev
	meson
	ninja
	pixman-dev
	wayland-dev
	wayland-protocols
	xcb-util-image-dev
	xcb-util-renderutil-dev
	xcb-util-wm-dev
	xkeyboard-config
	xwayland-dev
	"
subpackages="$pkgname-dbg $pkgname-dev"
source="https://gitlab.freedesktop.org/wlroots/wlroots/-/archive/$pkgver/wlroots-$pkgver.tar.gz"
options="!check" # no test suite
builddir="$srcdir/wlroots-$pkgver"

build() {
	abuild-meson \
		-Dexamples=false \
		. build
	meson compile ${JOBS:+-j ${JOBS}} -C build
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C build
}

sha512sums="
730b1e0cf003dabae23101664c6d1993636bd3a8ecbdb3c165eef415a92811c4d5228f48e0275f75361d8528f118dfb8a2298cfb05dbf6364539224ceedca447  wlroots-0.15.0.tar.gz
"
