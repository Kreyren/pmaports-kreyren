# forked from Alpine Linux
pkgname=nxp-mfgtools
pkgver=1.4.127
pkgrel=0
pkgdesc="Freescale/NXP i.MX Chip image deploy tools"
url="https://github.com/boundarydevices/imx_usb_loader"
arch="all"
license="LGPL-2.1-only"
options="!check !pmb:crossdirect" # No tests available
subpackages="$pkgname-uuu:_uuu lib$pkgname-dev"
makedepends="cmake libusb-dev bzip2-dev libzip-dev openssl-dev"
source="https://github.com/NXPmicro/mfgtools/archive/uuu_$pkgver.tar.gz"
builddir="$srcdir/mfgtools-uuu_$pkgver/"

prepare() {
	default_prepare
	echo "$pkgver" > "$builddir/.tarball-version"
}

build() {
	cmake -B "$builddir/build" \
	      -DCMAKE_INSTALL_PREFIX="/usr"
	cmake --build "$builddir/build"
}

package() {
	depends="$subpackages"

	DESTDIR="$pkgdir" cmake --build "$builddir/build" --target install

	install -D -m 0644 -t "$pkgdir/usr/lib/" \
	        "$builddir/build/libuuu/libuuc_s.a"

	install -D -m 0644 -t "$pkgdir/usr/include/" \
	        "$builddir/libuuu/libuuu.h"
}

_uuu() {
	mkdir -p "$subpkgdir/usr/bin"
	mv "$pkgdir/usr/bin/uuu" "$subpkgdir/usr/bin/"
}

sha512sums="3c4913862f5fb7d71792cda16c8b2563de81c30f807e0f9b7f4b88197ffb448babb20dbcbcbd287b841a03a767d30544d8de84a503d922f2076dc865e41866c3  uuu_1.4.127.tar.gz"
