# U-boot built for rk3328

pkgname=u-boot-quartz64
pkgver=2022.01_git20220119
_ref=88b081e461bba1610b2375a6592c6ce321655b77
pkgrel=1
pkgdesc="u-boot bootloader for the rk3568"
url="https://gitlab.com/u-boot/u-boot"
arch="aarch64"
license="GPL-2.0-or-later OFL-1.1 BSD-2-Clause BSD-3-Clause eCos-2.0 IBM-pibs
	ISC LGPL-2.0-only LGPL-2.1-only X11"
makedepends="$depends_dev bc dtc python3-dev swig bison flex openssl-dev"
options="!check"
source="
	https://gitlab.com/pgwipeout/u-boot-quartz64/-/archive/$_ref/u-boot-quartz64-$_ref.tar.gz
	rk3568_ddr_1560MHz_v1.11.bin::https://github.com/JeffyCN/rockchip_mirrors/blob/47404a141a1acb7555906b5e3b097b5f1045cc21/bin/rk35/rk3568_ddr_1560MHz_v1.11.bin?raw=true
	rk3568_bl31_v1.28.elf::https://github.com/JeffyCN/rockchip_mirrors/blob/6186debcac95553f6b311cee10669e12c9c9963d/bin/rk35/rk3568_bl31_v1.28.elf?raw=true
	fix-combined-var.patch
	compressed-kernel.patch
	update-u-boot
	"
builddir="$srcdir"/u-boot-quartz64-$_ref

build() {
	touch include/config.h
	LC_ALL=C date +'#define U_BOOT_DATE "%b %d %C%y"' > include/timestamp_autogenerated.h
	LC_ALL=C date +'#define U_BOOT_TIME "%T"' >> include/timestamp_autogenerated.h

	export BL31="$srcdir"/rk3568_bl31_v1.28.elf
	export COMBINED_FILE="$srcdir"/rk3568_ddr_1560MHz_v1.11.bin
	export BUILD_DIR="$builddir"/build
	mkdir -p "$BUILD_DIR"
	make O="$BUILD_DIR" HOSTCC=gcc ARCH=arm quartz64-a-rk3566_defconfig
	make O="$BUILD_DIR" HOSTCC=gcc ARCH=arm all
}

package() {
	install -D -m644 build/idbloader.img \
		"$pkgdir"/usr/share/u-boot/pine64-quartz64/idbloader.img
	install -D -m644 build/u-boot.itb \
		"$pkgdir"/usr/share/u-boot/pine64-quartz64/u-boot.itb
	install -D -m755 "$srcdir"/update-u-boot "$pkgdir"/usr/sbin/update-u-boot
}


sha512sums="
24fcad63d9c6783188b5d564535a24c3feb257d286885f98ff3ea77dd104823220a277d38617bffc7466a3877f1970d9399d7ccf2fda199cf8b10929621266fe  u-boot-quartz64-88b081e461bba1610b2375a6592c6ce321655b77.tar.gz
5d2e07af68c7e8cd92b087ddacdde53b4dee16052db089416d4e84da18a4ec0fe21331862654886e6aef0a07070a8982e32cf1755db4769937cfe4a691e80ff7  rk3568_ddr_1560MHz_v1.11.bin
0460358578434ea683dbe84fe820d5d6e5350c99be4db376099b9bf15a05b45af25316eb08d6d3fe5752b721b51b487bb1f6e87d7f20614ffa3a61b542a034c8  rk3568_bl31_v1.28.elf
604624759c091b8394be500e6ecd3e62f3732a5d6c7f9e1a2009cb0cd79268fd790a1f308bfce13e03d5f5b4417f5aaa941e748ae9f879685d8298c036f8b992  fix-combined-var.patch
55ae82e328d8e8fa7c740b3cbd2ba890fb1f25fa44df9e98573b0599045683ce4eca698018c6da99b738b5f44e1d7dd462bd22b1f3c947ad0a982ec62b2fe984  compressed-kernel.patch
5ffa497122f3fd23b0b1c055229d650895fd03ca415ba6fb6df2ba848023d523fc14caaaf13d5409cc4b03e73cb92493eac1d8952738376c46395de827cad509  update-u-boot
"
