# Maintainer:
pkgname=audiotube
pkgver=0_git20210327
pkgrel=1
_commit="8fa564e7f0e04d0b68bda977adcf31536bba1fb5"
pkgdesc="Client for YouTube Music"
url="https://invent.kde.org/jbbgameich/audiotube"
arch="all !armhf" # armhf blocked by extra-cmake-modules
license="GPL-2.0-or-later"
depends="kirigami2 qt5-qtmultimedia qt5-qtimageformats py3-ytmusicapi youtube-dl gst-plugins-good"
# qt5-qtsvg-dev: temporary, until fixed in Alpine edge
makedepends="cmake extra-cmake-modules kirigami2-dev qt5-qtsvg-dev ki18n-dev python3-dev py3-pybind11-dev"
source="https://invent.kde.org/jbbgameich/audiotube/-/archive/$_commit/audiotube-$_commit.tar.gz"
builddir="$srcdir/audiotube-$_commit"

build() {
	if [ "$CBUILD" != "$CHOST" ]; then
		CMAKE_CROSSOPTS="-DCMAKE_SYSTEM_NAME=Linux -DCMAKE_HOST_SYSTEM_NAME=Linux"
	fi
	cmake -B build \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_INSTALL_LIBDIR=lib \
		-DBUILD_SHARED_LIBS=True \
		-DCMAKE_BUILD_TYPE=None \
		$CMAKE_CROSSOPTS .
	cmake --build build
}

check() {
	cd build
	CTEST_OUTPUT_ON_FAILURE=TRUE ctest
}

package() {
	DESTDIR="$pkgdir" cmake --install build
}

sha512sums="fb31085e49b53933cb5809860cbeb1a374f9124d31c1669aa8f98949f8d3ce7f39ba5f405bebe8c210f5db987b1c7f95059e4ae112136b1c3733e8ad340ec00b  audiotube-8fa564e7f0e04d0b68bda977adcf31536bba1fb5.tar.gz"
